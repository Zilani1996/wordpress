pipeline{
agent any

 environment {
        DOCKER_REGISTRY = 'registry.digitalocean.com/vendorcity'
        KUBE_CONFIG = credentials('dop_v1_a368caa9815086b10972210118a3f162f73f6068d64c5d15f1061484cfda8c96')
    }

stages{
  stage("code clone"){
   steps{
    git url :"https://github.com/Zilani1996/wordpress.git",branch:"master"
    }
  }

        stage('Build and Push Docker Image') {
            steps {
                script {
                    def dockerImage = docker.build("wordpress_image")
                    dockerImage.push("egistry.digitalocean.com/vendorcity/wordpress_image:v1")
                }
            }
        }


 stage('Deploy') {
            steps {
                script {
                    def kubeConfigPath = writeKubeConfig("${env.WORKSPACE}/kubeconfig", env.KUBE_CONFIG)
                    sh "kubectl --kubeconfig=${kubeConfigPath} apply -f deploy.yaml"
                }
            }
        }

        stage('Cleanup') {
            steps {
                script {
                    def kubeConfigPath = writeKubeConfig("${env.WORKSPACE}/kubeconfig", env.KUBE_CONFIG)
                    sh "kubectl --kubeconfig=${kubeConfigPath} delete -f deploy.yaml"
                }
            }
      }
    }

}


